USE CATALOG default_catalog;
USE default_database;

CREATE TABLE lakehouse_txn_table_kafka_source (
  TRANID BIGINT,
  CHANNEL STRING,
  MERCHANTID STRING,
  SUBMER_ID STRING,
  BILLING_NAME STRING,
  BILLING_EMAIL STRING,
  BILLING_MOBILE STRING,
  BILLING_INFO STRING,
  ORDER_ID STRING,
  APP_CODE STRING,
  TRANS_ID STRING,
  BILL_AMT DECIMAL(20, 2),
  TRANSACTION_RATE DOUBLE,
  CUR_ACTUAL STRING,
  ACTUAL_AMT DECIMAL(20, 2),
  FRAUD_SCAN STRING,
  FRAUD_SCORE INT,
  STATUS STRING,
  STATUS_DESCRIPTION STRING,
  MEMO STRING,
  MODIFY_DATE BIGINT,
  CREATE_DATE BIGINT,
  TRANKEY STRING,
  STATUS_DESC STRING,
  CHARGEBACK_DATE BIGINT,
  REFUND_DATE BIGINT,
  REFUND_AMT DECIMAL(20, 2),
  HISTORY STRING,
  BIN INT,
  IP STRING,
  SEC_SCORE INT,
  SEC_MEMO STRING,
  SEC_CALL INT,
  SEC_RESULT STRING,
  CCREMINDER_ACK_IP STRING,
  CCREMINDER_ACK INT,
  FRAUD_DATE BIGINT,
  RECONCILED STRING,
  BANK_SETTLEMENT_DATE BIGINT,
  SETID INT,
  SETTLE_DATE BIGINT,
  BIN4 STRING,
  EXPDATE STRING,
  VCC STRING,
  BIN_NEXIST INT,
  USER_COUNTRY STRING,
  BANK_COUNTRY STRING,
  CUR_RATES DOUBLE,
  CUR_NUM STRING,
  CUR_AMT DECIMAL(20, 2),
  DEF_AMT DECIMAL(20, 2),
  DEF_CUR STRING,
  LOA STRING,
  LOA_NAME STRING,
  POPUPBLOCK STRING,
  ACK_FEEDBACK STRING,
  FRAUD_SCREENING INT,
  TRANSACTION_COST DECIMAL(10, 4),
  SUB_TRANSACTION STRING,
  PCODE STRING,
  DUE_TIME BIGINT,
  TICKET STRING,
  TERMINAL_ID STRING,
  TRACK_LAST_UPDATE STRING,
  L_VERSION INT,
  RECUR_FLAG STRING,
  PAID_DATE BIGINT,
  TOKEN_STATUS INT,
  IS_ESCROW STRING,
  MASTERPASS_TXNID STRING,
  VISACHECKOUT_TXNID STRING,
  DEF_CHANNEL STRING,
  CHANNEL_COST DECIMAL(20, 2),
  row_time AS TO_TIMESTAMP_LTZ(CREATE_DATE, 3),
  WATERMARK FOR row_time AS row_time - INTERVAL '5' SECOND,

  PRIMARY KEY (TRANID) NOT ENFORCED
) WITH (
  'connector' = 'upsert-kafka',
  'topic' = 'lakehouse_txn_stream_txn_metadata',
  'properties.bootstrap.servers' = 'broker:29092',
  'key.format' = 'json',
  'value.format' = 'json'
);